
library(RSQLite)

sqlite <- dbDriver("SQLite")
DriftDB<-'PamGuard64 2_00_16e Drift-23_JST.sqlite3'

DBDir<- 'H:/Odontocetes/Beaked whales/CCES_2018_Databases'
SPLabels<-c("ZC","BB","BW43","MS","MD","BW39V","BW70","BWC","?BW","BW")
conn <- dbConnect(sqlite,file.path(DBDir,DriftDB))

#Load in Event Info from Database 
Events <- dbReadTable(conn, "Click_Detector_OfflineEvents")         #read offline events
Events$eventType<-gsub(" ", "", Events$eventType, fixed = TRUE)
Events<-filter(Events,eventType %in% SPLabels)
Events$dateTimeStart<-strptime(Events$UTC,format="%Y-%m-%d %H:%M:%OS")
Events$dateTimeStart<-as.POSIXct(Events$dateTimeStart, tz="UTC")
Events$dateTimeStop<-strptime(Events$EventEnd,format="%Y-%m-%d %H:%M:%OS")
Events$dateTimeStop<-as.POSIXct(Events$dateTimeStop, tz="UTC")
dbDisconnect(conn)

#Save events in new database
MTCDir = 'H:/Odontocetes/Beaked whales/MTC'
db='PG_2_02_09_CCES_023.sqlite3'
dbNew<-file.path(MTCDir,db)


for(E in 1:nrow(Events)){
addPgEvent(dbNew,eventType=Events$eventType[E],start=Events$dateTimeStart[E],end=Events$dateTimeStop[E],type='click')
}

