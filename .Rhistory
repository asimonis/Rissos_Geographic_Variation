pps <- PAMpalSettings(db=db,
binaries = binFolder,
sr_hz='auto',
winLen_sec=.0025,
filterfrom_khz=10,
filterto_khz=80)
#Import known Risso's dolphin Event Times
GgTimes<-read.csv(here('EventTimes','ADRIFT_GgDetections.csv'))
GgTimes$start<-as.POSIXct(GgTimes$UTC,format='%Y-%m-%d %H:%M:%S',tz='UTC')
#Define end time. For CCES, this will be 2 minutes after file start time
GgTimes$end<-as.POSIXct(GgTimes$end,format='%Y-%m-%d %H:%M:%S',tz='UTC')
DriftTimes<-filter(GgTimes,DriftName==DriftID)
DriftTimes$id<-paste0(DriftID,'_',seq(1:nrow(DriftTimes)))
if(substr(DriftID,1,4)=='CCES'){
DriftTimes$end<-DriftTimes$start + seconds(119) }
#Use event times from CSV file
data <- processPgDetections(pps, mode='time',grouping=DriftTimes,
format='%m/%d/%y %H:%M',species='Gg',id=DriftID)
db <- paste0(baseDir,'/Databases/',DriftID,' - Copy.sqlite3')
pps <- PAMpalSettings(db=db,
binaries = binFolder,
sr_hz='auto',
winLen_sec=.0025,
filterfrom_khz=10,
filterto_khz=80)
#Import known Risso's dolphin Event Times
GgTimes<-read.csv(here('EventTimes','ADRIFT_GgDetections.csv'))
GgTimes$start<-as.POSIXct(GgTimes$UTC,format='%Y-%m-%d %H:%M:%S',tz='UTC')
#Define end time. For CCES, this will be 2 minutes after file start time
GgTimes$end<-as.POSIXct(GgTimes$end,format='%Y-%m-%d %H:%M:%S',tz='UTC')
DriftTimes<-filter(GgTimes,DriftName==DriftID)
DriftTimes$id<-paste0(DriftID,'_',seq(1:nrow(DriftTimes)))
if(substr(DriftID,1,4)=='CCES'){
DriftTimes$end<-DriftTimes$start + seconds(119) }
#Use event times from CSV file
data <- processPgDetections(pps, mode='time',grouping=DriftTimes,
format='%m/%d/%y %H:%M',species='Gg',id=DriftID)
saveRDS(data, paste0(baseDir,'/AcousticStudies/',DriftID,'_Gg.rds'))
baseDir
baseDir<-"C:/Users/annes/Documents/Github/Rissos_Geographic_Variation/data/"
DriftID<-'CCES_007'
binFolder <- paste0(baseDir,'Binaries/',DriftID)    #Folder with binaries
binFolder
# this database should be a COPY of the original because we will add events to it later
db <- paste0(baseDir,'Databases/',DriftID,' - Copy.sqlite3')
#Import known Risso's dolphin Event Times
GgTimes<-read.csv(here('EventTimes','ADRIFT_GgDetections.csv'))
GgTimes$start<-as.POSIXct(GgTimes$UTC,format='%Y-%m-%d %H:%M:%S',tz='UTC')
GgTimes$end<-as.POSIXct(GgTimes$end,format='%Y-%m-%d %H:%M:%S',tz='UTC')
DriftTimes<-filter(GgTimes,DriftName==DriftID)
DriftTimes$id<-paste0(DriftID,'_',seq(1:nrow(DriftTimes)))
if(substr(DriftID,1,4)=='CCES'){
DriftTimes$end<-DriftTimes$start + seconds(119) }
#Keep click detections from one channel (upper hydrophone = HTI-92-WB)
data<-filter(data, Channel==1)
#Omit click detectors 0 and 1
data<-filter(data,detectorName!='Click_Detector_0')
data<-filter(data,detectorName!='Click_Detector_1')
data<-filter(data, peak>15 & duration<2000)
ClickData<-getClickData(data)
#Add events to database
for(E in 1:nrow(DriftTimes)){
EventClicks<-filter(ClickData,eventId==DriftTimes$id[E])
addPgEvent(db,binary = data@events[[E]]@files[["binaries"]],
UIDs=EventClicks$UID,
eventType='Gg Click Event',
start=DriftTimes$start[E],
end=DriftTimes$end[E],
type='click')
}
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,100000))
?calculateAverageSpectra
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,100000),showBreaks=TRUE)
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,100000),evNum=1,showBreaks=TRUE)
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,100000),evNum=2,showBreaks=TRUE)
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,100000),evNum=2,mode='ceps')
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,evNum=2,mode='ceps')
#Plot mean spectrum & concatenated spectrogram
calculateAverageSpectra(data,flim=c(0,.2),evNum=2,mode='ceps')
knitr::opts_chunk$set(echo = TRUE)
library("easypackages")
library("lubridate")
libraries("PAMpal","PAMmisc","dplyr",  "here",'beepr')
here()
###USER-DEFINED FIELDS####
baseDir <- 'E:/Analysis/'
DriftID<-'ADRIFT_012'
binFolder <- paste0(baseDir,'Binaries/',DriftID)    #Folder with binaries
# this database should be a COPY of the original because we will add events to it later
db <- paste0(baseDir,'Databases/',DriftID,' - Copy.sqlite3')
data<-readRDS(paste0(baseDir,'AcousticStudies/',DriftID,'_Gg.rds'))
#Keep click detections from one channel (upper hydrophone = HTI-92-WB)
data<-filter(data, Channel==1)
###USER-DEFINED FIELDS####
baseDir <- 'E:/Analysis/'
DriftID<-'ADRIFT_012'
binFolder <- paste0(baseDir,'Binaries/',DriftID)    #Folder with binaries
# this database should be a COPY of the original because we will add events to it later
db <- paste0(baseDir,'Databases/',DriftID,' - Copy.sqlite3')
knitr::opts_chunk$set(echo = TRUE)
library("easypackages")
library("easypackages")
library("lubridate")
libraries("PAMpal","PAMmisc","dplyr",  "here",'beepr')
DriftID<-'ADRIFT_003'
baseDir<-here('data')
knitr::opts_chunk$set(echo = TRUE)
data<-readRDS(paste0(baseDir,'AcousticStudies/',DriftID,'_Gg.rds'))
baseDir<-
baseDir
"C:/Users/annes/Documents/Github/Rissos_Geographic_Variation/data/"
data<-readRDS(paste0(baseDir,'AcousticStudies/',DriftID,'_Gg.rds'))
data<-readRDS(paste0(baseDir,'/AcousticStudies/',DriftID,'_Gg.rds'))
#Keep click detections from one channel (upper hydrophone = HTI-92-WB)
data<-filter(data, Channel==1)
#Omit click detectors 0 and 1
data<-filter(data,detectorName!='Click_Detector_0')
data<-filter(data, peak>15 & duration<2000)
ClickData<-getClickData(data)
View(data)
ClickSummary <- ClickData %>%
group_by(eventID)%>%
summarise(ClickNum = n())
ClickSummary <- ClickData %>%
group_by(eventId)%>%
summarise(ClickNum = n())
View(ClickSummary)
AllEvents<-data.frame()
AllEvents<-rbind(ClickSummary)
ClickSummary2 <- ClickData %>%
group_by(eventId)%>%
summarise(ClickNum = n())
AllEvents<-rbind(ClickSummary, ClickSummary2)
l
AllEvents<-rbind(ClickSummary,  AllEvents)
DriftID<-'CCES_007'
data<-readRDS(paste0(baseDir,'AcousticStudies/',DriftID,'_Gg.rds'))
data<-readRDS(paste0(baseDir,'/AcousticStudies/',DriftID,'_Gg.rds'))
#Keep click detections from one channel (upper hydrophone = HTI-92-WB)
data<-filter(data, Channel==1)
#Omit click detectors 0 and 1
data<-filter(data,detectorName!='Click_Detector_0')
data<-filter(data,detectorName!='Click_Detector_1')
data<-filter(data, peak>15 & duration<2000)
ClickData<-getClickData(data)
ClickSummary <- ClickData %>%
group_by(eventId)%>%
summarise(ClickNum = n())
AllEvents<-rbind(ClickSummary,  AllEvents)
View(AllEvents)
here()
here('data')
#Load all detection data
data<-read.csv(here('EventTimes','AllDetections_wGPS.csv'))
library(here)
#Load all detection data
data<-read.csv(here('EventTimes','AllDetections_wGPS.csv'))
species<-unique(data$species)
species
data<-data %>%
filter(species %in% c())
#Only keep odontocete detections
#Remove all baleen whales and anthro detections
odontocetes<-c('Lo','MS','ZC','UO','BB','Gg','MC','BW','BW43','BWC')
OdontoceteData<-data %>%
filter(species %in% odontocetes)
library(tidyverse)
OdontoceteData<-data %>%
filter(species %in% odontocetes)
GgData<-data %>%
filter(species=="Gg")
#Loop through all drifts with Risso's
GgDrifts<-unique(GgData$DriftName)
#Only keep odontocete events
#Remove all baleen whales and anthro detections, and Risso's
odontocetes<-c('Lo','MS','ZC','UO','BB','MC','BW','BW43','BWC')
#Only keep odontocete events
#Remove all baleen whales and anthro detections, and Risso's
odontocetes<-c('Lo','MS','ZC','UO','BB','MC','BW','BW43','BWC')
OdontoceteData<-data %>%
filter(species %in% odontocetes)
d<-1
GgDrifts[d]
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC & ODriftEvents$UTC<GgDriftEvents$end)
e<-1
overlap<-which(ODriftEvents$UTC>GgDriftEvents[e]$UTC & ODriftEvents$UTC<GgDriftEvents[e]$end)
GgDriftEvents[e]$UTC
GgDriftEvents$UTC[e]
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
library(lubridate)
GgDriftEvents$UTC[e]-minutes(20)
GgDriftEvents$UTC[e]-minute(20)
GgDriftEvents$UTC[e]
data$UTC<-as.POSIXct(data$UTC,format='%Y-%m-%d %H:%M:%S',tz='UTC')
#Only keep odontocete events
#Remove all baleen whales and anthro detections, and Risso's
odontocetes<-c('Lo','MS','ZC','UO','BB','MC','BW','BW43','BWC')
OdontoceteData<-data %>%
filter(species %in% odontocetes)
#Risso's events
GgData<-data %>%
filter(species=="Gg")
GgDrifts<-unique(GgData$DriftName)
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
GgDriftEvents$UTC[e]-minutes(20)
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e] )
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e] )
data$end<-as.POSIXct(data$end,format='%Y-%m-%d %H:%M:%S',tz='UTC')
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e] )
data$end<-as.POSIXct(data$end,format='%Y-%m-%d %H:%M:%S',tz='UTC')
#Only keep odontocete events
#Remove all baleen whales and anthro detections, and Risso's
odontocetes<-c('Lo','MS','ZC','UO','BB','MC','BW','BW43','BWC')
OdontoceteData<-data %>%
filter(species %in% odontocetes)
#Risso's events
GgData<-data %>%
filter(species=="Gg")
#Loop through all drifts with Risso's
#For each Risso's event
#determine if there is any overlap with other odontocetes
#Generate a list of mixed species events to omit from analysis
GgDrifts<-unique(GgData$DriftName)
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e] )
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e] )
#Loop through all drifts with Risso's
#For each Risso's event
#determine if there is any overlap with other odontocetes
#Generate a list of mixed species events to omit from analysis
Events_MixedSpp<-()
#Loop through all drifts with Risso's
#For each Risso's event
#determine if there is any overlap with other odontocetes
#Generate a list of mixed species events to omit from analysis
Events_MixedSpp<-as.character()
Events_Near_GgStart<-as.character()
Events_Near_GgEnd<-as.character()
e<-2
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))
print(paste('Events',BeforeGgStart,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))
print(paste('Events',AfterGgEnd,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))
}
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))
print(paste('Events',BeforeGgStart,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))
print(paste('Events',AfterGgEnd,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))
}
}
for(d in 1:length(GgDrifts)){
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))
print(paste('Events',BeforeGgStart,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))
print(paste('Events',AfterGgEnd,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))
}
}
}
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))}
if (length(BeforeGgStart) > 0){
print(paste('Events',BeforeGgStart,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))}
if (length(AfterGgEnd) > 0){
print(paste('Events',AfterGgEnd,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))}
}
}
}
e
d
d<-31
GgDrifts[d]
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
e<-1
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
remove(overlap,BeforeGgStart,AfterGgEnd)
Events_MixedSpp<-as.character()
Events_Near_GgStart<-as.character()
Events_Near_GgEnd<-as.character()
GgDrifts<-unique(GgData$DriftName)
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Events',overlap,'on Drift:',GgDrifts[d],'is a mixed species event'))}
if (length(BeforeGgStart) > 0){
print(paste('Events',BeforeGgStart,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))}
if (length(AfterGgEnd) > 0){
print(paste('Events',AfterGgEnd,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))}
}
remove(overlap,BeforeGgStart,AfterGgEnd)
}
}
GgDrifts
d<-5
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
GgDrifts[d]
e<-1
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
e<-2
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
GgDriftEvents$end[e]
ODriftEvents$UTC[AfterGgEnd]
ODriftEvents$species[AfterGgEnd]
remove(overlap,BeforeGgStart,AfterGgEnd)
GgDrifts<-unique(GgData$DriftName)
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Events',e,'on Drift:',GgDrifts[d],'is a mixed species event'))}
if (length(BeforeGgStart) > 0){
print(paste('Events',e,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event Start'))}
if (length(AfterGgEnd) > 0){
print(paste('Events',e,'on Drift:',GgDrifts[d],'occurs within 20 min of Gg Event End'))}
}
remove(overlap,BeforeGgStart,AfterGgEnd)
}
}
Gg37<-filter(GgData,DriftName=='ADRIFT_037')
Gg39<-filter(GgData,DriftName=='ADRIFT_039')
Events_MixedSpp<-as.character()
Events_Near_GgStart<-as.character()
Events_Near_GgEnd<-as.character()
GgDrifts<-unique(GgData$DriftName)
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'is a mixed species event'))}
if (length(BeforeGgStart) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event Start'))}
if (length(AfterGgEnd) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event End'))}
}
remove(overlap,BeforeGgStart,AfterGgEnd)
}
}
View(Gg39)
Events_MixedSpp<-as.character()
Events_Near_GgStart<-as.character()
Events_Near_GgEnd<-as.character()
GgDrifts<-unique(GgData$DriftName)
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'is a mixed species event'))
Events_MixedSpp<-c(Events_MixedSpp,paste(GgDrifts[d],'00',e))}
if (length(BeforeGgStart) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event Start'))}
if (length(AfterGgEnd) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event End'))}
}
remove(overlap,BeforeGgStart,AfterGgEnd)
}
}
Events_MixedSpp<-as.character()
Events_Near_GgStart<-as.character()
Events_Near_GgEnd<-as.character()
GgDrifts<-unique(GgData$DriftName)
for(d in 1:length(GgDrifts)){
#Risso's events in this drift
GgDriftEvents<-filter(GgData,DriftName==GgDrifts[d])
#Odontocete events in this drift
ODriftEvents<-filter(OdontoceteData,DriftName==GgDrifts[d])
#loop through each Risso's event on this drift to look for overlap
for(e in 1:nrow(GgDriftEvents)){
overlap<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e] & ODriftEvents$UTC<GgDriftEvents$end[e])
#look for events within 20 minutes of start
BeforeGgStart<-which(ODriftEvents$UTC>GgDriftEvents$UTC[e]-minutes(20)& ODriftEvents$UTC<GgDriftEvents$UTC[e])
AfterGgEnd<-which(ODriftEvents$UTC<GgDriftEvents$end[e]+minutes(20) & ODriftEvents$end>GgDriftEvents$end[e])
if (any(c( overlap, BeforeGgStart, AfterGgEnd) > 0)) {
if (length(overlap) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'is a mixed species event'))
Events_MixedSpp<-c(Events_MixedSpp,paste0(GgDrifts[d],'_00',e))}
if (length(BeforeGgStart) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event Start'))
Events_Near_GgStart<-c(Events_Near_GgStart,paste0(GgDrifts[d],'_00',e))}
if (length(AfterGgEnd) > 0){
print(paste('Event',e,'on Drift:',GgDrifts[d],'has another odontocete event within 20 min of Gg Event End'))
Events_Near_GgEnd<-c(Events_Near_GgEnd,paste0(GgDrifts[d],'_00',e))}
}
remove(overlap,BeforeGgStart,AfterGgEnd)
}
}
EventsToRemove<-c(Events_MixedSpp,Events_Near_GgStart,Events_Near_GgEnd)
EventsToRemove
sort(EventsToRemove)
write.csv(EventsToRemove,file=here('EventTimes','GgEventsToRemove.csv')
)
write.csv(EventsToRemove,file=here('EventTimes','GgEventsToRemove.csv'),row.names = F)
write.csv(EventsToRemove,file=here('EventTimes','GgEventsToRemove.csv'),
row.names = F,col.names = F)
?write.csv
write.csv(EventsToRemove,file=here('EventTimes','GgEventsToRemove.csv'),
row.names = F,col.names='EventName')
write.table(EventsToRemove,file=here('EventTimes','GgEventsToRemove.csv'),
row.names = F,col.names='EventName')
unique(GgData$DriftName)
library(ggplot2)
library(tidyver)
library(tidyverse)
library(readr)
EddyTracker_2025_11_17 <- read_csv("C:/Users/annes/Documents/health/Vestibular neritus/EddyTracker_2025-11-17.csv")
View(EddyTracker_2025_11_17)
Eddy <- read_csv("C:/Users/annes/Documents/health/Vestibular neritus/EddyTracker_2025-11-17.csv")
View(EddyTracker_2025_11_17)
